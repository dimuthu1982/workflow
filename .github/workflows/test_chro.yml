name: Merge branch to master
run-name: Merge ${{ github.head_ref }} to master (hotfix) 🏷️
on: [push]
jobs:
  extract-tag-in-branch:
     #if: ${{ startsWith(github.head_ref, 'release/') }}
     name: Tag From Latest Version
     runs-on: ubuntu-latest
     outputs:
       TAG_NAME: ${{steps.branch_tag.outputs.TAG_NAME}}
     steps:
        - uses: actions/checkout@v4
        - if: ${{ startsWith(github.head_ref, 'release/') }} || true
          name: Find Version From Branch
          id: release_version
          run: | 
            echo BRANCH="${{github.head_ref}}" >> $GITHUB_ENV
            BRANCH="release/1.3.0" #TBR
            echo "Branch New: ${BRANCH}"
            echo "Release Branch with version"
            echo "TAG_NAME=${BRANCH/'release/'}" >> $GITHUB_ENV
            echo "Tag - $TAG_NAME"

        - if: ${{ github.head_ref == 'release' }}
          name: Release Branch
          id: release_type1
          run: echo "RELEASE_TYPE=minor" >> $GITHUB_ENV

        - if: ${{ startsWith(github.head_ref, 'hotfix/') }}
          name: Release Branch
          id: release_type2
          run: echo "RELEASE_TYPE=patch" >> $GITHUB_ENV

        - if: ${{ env.RELEASE_TYPE }}
          name: Initiating Next Version Lookup
          uses: reecetech/version-increment@2023.10.1
          with:
              use_api: true
              increment: ${{ env.RELEASE_TYPE }}
        - run: echo "TAG_NAME=${{ steps.release_version.outputs.TAG_NAME }}" >> $GITHUB_ENV

        - if: ${{ env.TAG_NAME }}
          name: Create Tag
          run: |
            RELEASING_TAG=${{ env.TAG_NAME }}
            echo "Next Tag - $RELEASING_TAG"
            git config --global user.name ${{ github.triggering_actor }}
            git config --global user.email dimuthu.abeynayakage@sportsbet.com.au
            git tag $RELEASING_TAG
            git push --tags
